<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow - Tw√≥j Inteligentny Asystent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --success: #10b981;
            --bg-dark: #0f0f1e;
            --bg-card: #1a1a2e;
            --bg-hover: #252538;
            --text: #e2e8f0;
            --text-secondary: #94a3b8;
            --border: #2d2d44;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-gradient {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.4;
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--bg-card);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid var(--border);
        }

        .avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--bg-card);
            padding: 8px;
            border-radius: 16px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .nav-btn:hover {
            color: var(--text);
            background: var(--bg-hover);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .card-meta {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .card-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-primary {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-accent {
            background: rgba(236, 72, 153, 0.2);
            color: var(--accent);
        }

        .flashcard {
            height: 220px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 500;
        }

        .flashcard-front {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .flashcard-back {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            transform: rotateY(180deg);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-hover);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 8px;
            font-size: 14px;
        }

        .action-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box {
            flex: 1;
            padding: 12px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        .search-box:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .lecture-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .lecture-item:hover {
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .lecture-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .lecture-info {
            flex: 1;
        }

        .lecture-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .lecture-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-hover);
            transition: 0.3s;
            border-radius: 34px;
            border: 2px solid var(--border);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: var(--text-secondary);
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
            background-color: white;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            nav {
                overflow-x: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="background-gradient"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üìö</div>
                <span>StudyFlow</span>
            </div>
            <div class="user-info">
                <div class="avatar">JS</div>
                <span>Jan Kowalski</span>
            </div>
        </header>

        <nav>
            <button class="nav-btn active" data-tab="dashboard">üìä Dashboard</button>
            <button class="nav-btn" data-tab="flashcards">üé¥ Fiszki</button>
            <button class="nav-btn" data-tab="lectures">üìñ Wyk≈Çady</button>
            <button class="nav-btn" data-tab="new-lecture">‚ú® Nowy wyk≈Çad</button>
            <button class="nav-btn" data-tab="subjects">üìö Przedmioty</button>
            <button class="nav-btn" data-tab="schedule">üìÖ Plan zajƒôƒá</button>
            <button class="nav-btn" data-tab="settings">‚öôÔ∏è Ustawienia</button>
        </nav>

        <!-- Dashboard -->
        <div class="content active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">127</div>
                    <div class="stat-label">Fiszek opanowanych</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">8</div>
                    <div class="stat-label">Aktywnych przedmiot√≥w</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">94%</div>
                    <div class="stat-label">≈örednia skuteczno≈õƒá</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Dni streak</div>
                </div>
            </div>

            <h2 style="margin-bottom: 20px; font-size: 22px;">Ostatnia aktywno≈õƒá</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Algorytmy i struktury danych</div>
                        <span class="badge badge-primary">W trakcie</span>
                    </div>
                    <div class="card-meta">Ostatnia powt√≥rka: 2 godziny temu</div>
                    <div class="card-content">25 fiszek do powt√≥rzenia dzisiaj</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 68%"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Bazy danych</div>
                        <span class="badge badge-success">Uko≈Ñczono</span>
                    </div>
                    <div class="card-meta">Wyk≈Çad: wczoraj 14:00</div>
                    <div class="card-content">Wszystkie notatki zsynchronizowane</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">In≈ºynieria oprogramowania</div>
                        <span class="badge badge-accent">Nadchodzi</span>
                    </div>
                    <div class="card-meta">Projekt: za 3 dni</div>
                    <div class="card-content">Dokumentacja do przygotowania</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flashcards -->
        <div class="content" id="flashcards">
            <div class="action-bar">
                <input type="text" class="search-box" placeholder="üîç Szukaj fiszek...">
                <button class="btn btn-secondary" onclick="openStudyMode()">üéØ Ucz siƒô</button>
                <button class="btn btn-primary">+ Dodaj fiszkƒô</button>
            </div>

            <h2 style="margin-bottom: 20px; font-size: 22px;">Twoje fiszki</h2>
            <div class="grid">
                <div class="card flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div>Co to jest algorytm sortowania przez scalanie?</div>
                        </div>
                        <div class="flashcard-back">
                            <div>Algorytm dziel i zwyciƒô≈ºaj, kt√≥ry rekurencyjnie dzieli tablicƒô na po≈Çowy, sortuje je i scala. Z≈Ço≈ºono≈õƒá: O(n log n)</div>
                        </div>
                    </div>
                </div>

                <div class="card flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div>Czym jest normalizacja bazy danych?</div>
                        </div>
                        <div class="flashcard-back">
                            <div>Proces organizacji danych w celu redukcji redundancji i poprawy integralno≈õci poprzez podzia≈Ç na powiƒÖzane tabele</div>
                        </div>
                    </div>
                </div>

                <div class="card flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div>Co to jest SOLID?</div>
                        </div>
                        <div class="flashcard-back">
                            <div>Piƒôƒá zasad programowania obiektowego: Single Responsibility, Open/Closed, Liskov Substitution, Interface Segregation, Dependency Inversion</div>
                        </div>
                    </div>
                </div>

                <div class="card flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div>R√≥≈ºnica miƒôdzy procesem a wƒÖtkiem?</div>
                        </div>
                        <div class="flashcard-back">
                            <div>Proces to niezale≈ºna instancja programu z w≈ÇasnƒÖ pamiƒôciƒÖ. WƒÖtek to jednostka wykonywalna w procesie, wsp√≥≈ÇdzielƒÖca pamiƒôƒá</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Mode Interface -->
            <div id="study-mode-container" style="display: none; margin-top: 30px;">
                <!-- Study Selection Step -->
                <div class="study-step active" id="study-selection">
                    <h3>Rozpocznij sesjƒô nauki</h3>
                    <div class="study-form">
                        <label>Wybierz przedmiot:</label>
                        <select id="study-subject-select" class="form-control">
                            <option value="">Wybierz przedmiot...</option>
                        </select>
                        
                        <label>Wybierz wyk≈Çad:</label>
                        <select id="study-lecture-select" class="form-control">
                            <option value="">Najpierw wybierz przedmiot</option>
                        </select>
                        
                        <label>Tryb nauki:</label>
                        <div class="study-mode-buttons">
                            <button class="study-mode-btn" data-mode="flashcards">
                                üé¥ Fiszki
                            </button>
                            <button class="study-mode-btn" data-mode="quiz">
                                üìù Quiz
                            </button>
                            <button class="study-mode-btn" data-mode="memory">
                                üß† Pamiƒôƒá
                            </button>
                        </div>
                        
                        <button id="btn-start-study" class="btn btn-primary" disabled>
                            üöÄ Rozpocznij naukƒô
                        </button>
                    </div>
                </div>

                <!-- Study Session Step -->
                <div class="study-step" id="study-session" style="display: none;">
                    <!-- Content will be dynamically generated -->
                </div>

                <!-- Study Results Step -->
                <div class="study-step" id="study-results" style="display: none;">
                    <!-- Content will be dynamically generated -->
                </div>
            </div>
        </div>

        <!-- Lectures -->
        <div class="content" id="lectures">
            <div class="action-bar">
                <input type="text" class="search-box" placeholder="üîç Szukaj wyk≈Çad√≥w...">
                <button class="btn btn-primary">+ Dodaj wyk≈Çad</button>
            </div>

            <h2 style="margin-bottom: 20px; font-size: 22px;">NadchodzƒÖce wyk≈Çady</h2>
            
            <div class="lecture-item">
                <div class="lecture-icon">üíª</div>
                <div class="lecture-info">
                    <div class="lecture-title">Algorytmy i Struktury Danych - Drzewa BST</div>
                    <div class="lecture-date">Poniedzia≈Çek, 10:15 - 12:00 | Sala 204</div>
                </div>
                <span class="badge badge-accent">Za 2 dni</span>
            </div>

            <div class="lecture-item">
                <div class="lecture-icon">üóÑÔ∏è</div>
                <div class="lecture-info">
                    <div class="lecture-title">Bazy Danych - Transakcje i blokady</div>
                    <div class="lecture-date">Wtorek, 14:00 - 15:45 | Sala 108</div>
                </div>
                <span class="badge badge-accent">Za 3 dni</span>
            </div>

            <div class="lecture-item">
                <div class="lecture-icon">üèóÔ∏è</div>
                <div class="lecture-info">
                    <div class="lecture-title">In≈ºynieria Oprogramowania - Wzorce projektowe</div>
                    <div class="lecture-date">≈öroda, 12:15 - 14:00 | Sala 315</div>
                </div>
                <span class="badge badge-primary">Za 4 dni</span>
            </div>

            <h2 style="margin: 30px 0 20px 0; font-size: 22px;">Historia wyk≈Çad√≥w</h2>
            
            <div class="lecture-item">
                <div class="lecture-icon">üåê</div>
                <div class="lecture-info">
                    <div class="lecture-title">Sieci Komputerowe - Protoko≈Çy TCP/IP</div>
                    <div class="lecture-date">PiƒÖtek, 08:00 - 09:45 | Online</div>
                </div>
                <span class="badge badge-success">Uko≈Ñczono</span>
            </div>
        </div>

        <!-- New Lecture -->
        <div class="content" id="new-lecture">
            <h2 style="margin-bottom: 20px; font-size: 22px;">‚ú® Utw√≥rz nowy wyk≈Çad z transkrypcjƒÖ AI</h2>
            
            <div class="card" style="max-width: 800px; margin: 0 auto;">
                <div class="card-header">
                    <div class="card-title">Nagranie wyk≈Çadu</div>
                </div>
                <div class="card-content" style="padding: 24px;">
                    <form id="new-lecture-form" style="display: grid; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                                Przedmiot
                            </label>
                            <select id="lecture-subject" class="search-box" style="width: 100%; cursor: pointer;" required>
                                <option value="">-- Wybierz przedmiot --</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                                Plik audio wyk≈Çadu
                            </label>
                            <div id="audio-dropzone" style="
                                border: 2px dashed var(--border);
                                border-radius: 12px;
                                padding: 40px;
                                text-align: center;
                                background: var(--bg-hover);
                                cursor: pointer;
                                transition: all 0.3s;
                            ">
                                <div style="font-size: 48px; margin-bottom: 12px;">üéµ</div>
                                <p style="color: var(--text); font-weight: 600; margin-bottom: 8px;">
                                    PrzeciƒÖgnij plik audio tutaj
                                </p>
                                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">
                                    lub kliknij aby wybraƒá
                                </p>
                                <p style="color: var(--text-secondary); font-size: 12px;">
                                    Wspierane formaty: MP3, WAV, M4A, OGG (maks. 500MB)
                                </p>
                                <input type="file" id="audio-file" accept="audio/*" style="display: none;" required>
                            </div>
                            <div id="audio-info" style="margin-top: 12px; display: none;">
                                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border);">
                                    <span style="font-size: 24px;">üéµ</span>
                                    <div style="flex: 1;">
                                        <div id="audio-filename" style="font-weight: 600; color: var(--text);"></div>
                                        <div id="audio-size" style="font-size: 12px; color: var(--text-secondary);"></div>
                                    </div>
                                    <button type="button" id="audio-remove" class="btn" style="background: var(--bg-hover); color: var(--text); padding: 8px 16px;">
                                        Usu≈Ñ
                                    </button>
                                </div>
                                <div id="audio-warning" style="margin-top: 12px; padding: 12px; border-radius: 8px; display: none;"></div>
                            </div>
                        </div>
                        
                        <div id="transcription-progress" style="display: none;">
                            <div style="margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <span id="progress-label" style="font-weight: 600; color: var(--text);">Przetwarzanie...</span>
                                <span id="progress-percent" style="color: var(--text-secondary); font-size: 14px;">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div id="progress-phase" style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);"></div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 12px;">
                            <button type="button" id="lecture-cancel" class="btn" style="background: var(--bg-hover); color: var(--text);">
                                Anuluj
                            </button>
                            <button type="submit" id="lecture-submit" class="btn btn-primary">
                                üöÄ Transkrybuj i utw√≥rz wyk≈Çad
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div id="lecture-result" style="display: none; margin-top: 30px;">
                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <div class="card-header">
                        <div class="card-title">‚úÖ Wyk≈Çad utworzony</div>
                    </div>
                    <div class="card-content" style="padding: 24px;">
                        <p style="color: var(--text); margin-bottom: 16px;">
                            Tw√≥j wyk≈Çad zosta≈Ç pomy≈õlnie przetworzony i zapisany!
                        </p>
                        <div id="lecture-result-info" style="background: var(--bg-hover); padding: 16px; border-radius: 8px; margin-bottom: 16px;"></div>
                        <button class="btn btn-primary" onclick="location.reload()">
                            Utw√≥rz kolejny wyk≈Çad
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects -->
        <div class="content" id="subjects">
            <div class="action-bar">
                <input type="text" class="search-box" placeholder="üîç Szukaj przedmiot√≥w...">
                <button class="btn btn-primary">+ Dodaj przedmiot</button>
            </div>

            <h2 style="margin-bottom: 20px; font-size: 22px;">Twoje przedmioty</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üíª Algorytmy i Struktury Danych</div>
                        <span class="badge badge-primary">6 ECTS</span>
                    </div>
                    <div class="card-meta">Wyk≈Çadowca: Dr. Anna Nowak</div>
                    <div class="card-content">
                        <p style="margin-bottom: 8px;">42 fiszek | 12 wyk≈Çad√≥w | 8 laboratori√≥w</p>
                        <p>Ocena ≈õr√≥dsemestralna: 85%</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üóÑÔ∏è Bazy Danych</div>
                        <span class="badge badge-success">5 ECTS</span>
                    </div>
                    <div class="card-meta">Wyk≈Çadowca: Prof. Jan Wi≈õniewski</div>
                    <div class="card-content">
                        <p style="margin-bottom: 8px;">35 fiszek | 10 wyk≈Çad√≥w | 10 laboratori√≥w</p>
                        <p>Projekt: Sklep internetowy (92%)</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèóÔ∏è In≈ºynieria Oprogramowania</div>
                        <span class="badge badge-accent">6 ECTS</span>
                    </div>
                    <div class="card-meta">Wyk≈Çadowca: Dr. Piotr Kowalczyk</div>
                    <div class="card-content">
                        <p style="margin-bottom: 8px;">28 fiszek | 14 wyk≈Çad√≥w | Projekt zespo≈Çowy</p>
                        <p>Sprint 2/4 w trakcie</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 55%"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üåê Sieci Komputerowe</div>
                        <span class="badge badge-primary">5 ECTS</span>
                    </div>
                    <div class="card-meta">Wyk≈Çadowca: Dr. Marek Lewandowski</div>
                    <div class="card-content">
                        <p style="margin-bottom: 8px;">22 fiszek | 11 wyk≈Çad√≥w | 6 laboratori√≥w</p>
                        <p>Egzamin praktyczny: za 2 tygodnie</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 68%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule -->
        <div class="content" id="schedule">
            <h2 style="margin-bottom: 20px; font-size: 22px;">Plan zajƒôƒá - Tydzie≈Ñ 7</h2>
            
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Poniedzia≈Çek</div>
                        <span class="badge badge-primary">4 zajƒôcia</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">08:00 - 09:45</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Matematyka dyskretna | S-105</div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">10:15 - 12:00</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Algorytmy i SD (wyk≈Çad) | S-204</div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">12:15 - 14:00</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Algorytmy i SD (lab) | L-301</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Wtorek</div>
                        <span class="badge badge-success">3 zajƒôcia</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">10:00 - 11:45</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Sieci komputerowe | S-108</div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">14:00 - 15:45</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Bazy danych (wyk≈Çad) | S-201</div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px;">
                            <div style="font-weight: 600;">16:00 - 17:45</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Bazy danych (lab) | L-205</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">≈öroda</div>
                        <span class="badge badge-accent">2 zajƒôcia</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">12:15 - 14:00</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">In≈ºynieria oprogramowania | S-315</div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-hover); border-radius: 8px;">
                            <div style="font-weight: 600;">14:15 - 16:00</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Projekt zespo≈Çowy | L-401</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div class="content" id="settings">
            <h2 style="margin-bottom: 30px; font-size: 22px;">Ustawienia</h2>
            
            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üë§ Profil u≈ºytkownika
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Imiƒô i nazwisko</label>
                        <input type="text" value="Jan Kowalski" class="search-box" style="width: 100%; max-width: 400px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Email</label>
                        <input type="email" value="jan.kowalski@student.edu.pl" class="search-box" style="width: 100%; max-width: 400px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Kierunek studi√≥w</label>
                        <select class="search-box" style="width: 100%; max-width: 400px;">
                            <option>Informatyka</option>
                            <option>Matematyka</option>
                            <option>Fizyka</option>
                            <option>Elektronika</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 14px;">Rok studi√≥w</label>
                        <select class="search-box" style="width: 100%; max-width: 400px;">
                            <option>1</option>
                            <option selected>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üéØ Preferencje nauki
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Dzienny cel fiszek</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Liczba fiszek do nauki dziennie</div>
                        </div>
                        <input type="number" value="20" class="search-box" style="width: 80px; text-align: center;">
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Automatyczne powt√≥rki</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Przypomnienia o powt√≥rkach wed≈Çug krzywej zapominania</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Tryb nauki</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Preferowany styl nauki fiszek</div>
                        </div>
                        <select class="search-box" style="width: 200px;">
                            <option>Klasyczny</option>
                            <option selected>Spaced Repetition</option>
                            <option>Intensywny</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üîî Powiadomienia
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Powiadomienia email</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Otrzymuj podsumowania na email</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Przypomnienia o wyk≈Çadach</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Powiadomienia 15 min przed zajƒôciami</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">OsiƒÖgniƒôcia i streaki</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Informacje o osiƒÖgniƒôciach i utrzymaniu streaka</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Deadliny projekt√≥w</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Przypomnienia o zbli≈ºajƒÖcych siƒô terminach</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üé® WyglƒÖd
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Motyw kolorystyczny</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Wybierz preferowany motyw interfejsu</div>
                        </div>
                        <select class="search-box" style="width: 200px;">
                            <option selected>Ciemny (Dark)</option>
                            <option>Jasny (Light)</option>
                            <option>Automatyczny</option>
                        </select>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Kolor akcentu</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">G≈Ç√≥wny kolor interfejsu</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border: 3px solid var(--primary); cursor: pointer;"></div>
                            <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #10b981, #059669); border: 2px solid var(--border); cursor: pointer;"></div>
                            <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #f59e0b, #d97706); border: 2px solid var(--border); cursor: pointer;"></div>
                            <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #ec4899, #be185d); border: 2px solid var(--border); cursor: pointer;"></div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Animacje</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Efekty przej≈õƒá i animacje interfejsu</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üîí Prywatno≈õƒá i bezpiecze≈Ñstwo
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Widoczno≈õƒá profilu</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Kto mo≈ºe zobaczyƒá tw√≥j profil</div>
                        </div>
                        <select class="search-box" style="width: 200px;">
                            <option>Publiczny</option>
                            <option selected>Tylko znajomi</option>
                            <option>Prywatny</option>
                        </select>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Dwusk≈Çadnikowe uwierzytelnianie</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Dodatkowa warstwa bezpiecze≈Ñstwa</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div>
                        <button class="btn btn-primary">Zmie≈Ñ has≈Ço</button>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 20px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    üóÉÔ∏è ZarzƒÖdzanie bazƒÖ danych
                </h3>
                <div style="display: grid; gap: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Wyczy≈õƒá osierocone fiszki</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Usu≈Ñ fiszki z usuniƒôtych wyk≈Çad√≥w</div>
                        </div>
                        <button class="btn" style="background: var(--accent); color: white;" onclick="cleanupOrphanedFlashcards()">
                            üßπ Wyczy≈õƒá
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Sprawd≈∫ stan bazy</div>
                            <div style="color: var(--text-secondary); font-size: 14px;">Wy≈õwietl statystyki i problemy</div>
                        </div>
                        <button class="btn" style="background: var(--secondary); color: white;" onclick="checkDatabaseHealth()">
                            üìä Sprawd≈∫
                        </button>
                    </div>
                    
                    <div id="database-status" style="padding: 15px; background: var(--bg-hover); border-radius: 8px; border-left: 4px solid var(--primary); display: none;">
                        <div style="font-weight: 600; margin-bottom: 8px;">Status bazy danych:</div>
                        <div id="database-details" style="color: var(--text-secondary); font-size: 14px;"></div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-primary" onclick="alert('Ustawienia zapisane! ‚úÖ')">üíæ Zapisz zmiany</button>
                <button class="btn" style="background: var(--bg-hover); color: var(--text);">Anuluj</button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/idb@8.0.0/build/umd.js"></script>
    <script type="module">
        // ============================================
        // STUDENT ASSISTANT - FULL FUNCTIONAL VERSION
        // ============================================
        
        // Import external libraries
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';
        
        // ============================================
        // DATABASE SETUP (IndexedDB)
        // ============================================
        
        let dbPromise = null;
        
        function openDatabase() {
            if (dbPromise) return dbPromise;
            
            dbPromise = idb.openDB('student-asystent', 2, {
                upgrade(database, oldVersion) {
                    // V1 - podstawowa struktura
                    if (oldVersion < 1) {
                        database.createObjectStore('subjects');
                        const sessions = database.createObjectStore('sessions');
                        sessions.createIndex('bySubject', 'subjectId');
                        const notes = database.createObjectStore('notes');
                        notes.createIndex('bySession', 'sessionId');
                        const flash = database.createObjectStore('flashcards');
                        flash.createIndex('bySubject', 'subjectId');
                        flash.createIndex('byDueDate', 'dueDate');
                        database.createObjectStore('tempFiles');
                    }
                    
                    // V2 - nowa struktura z Lectures
                    if (oldVersion < 2) {
                        const lectures = database.createObjectStore('lectures');
                        lectures.createIndex('bySubject', 'subjectId');
                        lectures.createIndex('byDate', 'createdAt');
                        
                        const tabs = database.createObjectStore('lectureTabs');
                        tabs.createIndex('byLecture', 'lectureId');
                        tabs.createIndex('byKind', 'kind');
                        
                        const quiz = database.createObjectStore('quizQuestions');
                        quiz.createIndex('byLecture', 'lectureId');
                        
                        const chat = database.createObjectStore('chatMessages');
                        chat.createIndex('byLecture', 'lectureId');
                    }
                }
            });
            
            return dbPromise;
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function uid(prefix = 'id_') {
            return prefix + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function log(message) {
            console.log(`[${new Date().toISOString()}] ${message}`);
        }
        
        // ============================================
        // SETTINGS MANAGEMENT
        // ============================================
        
        function getSettings() {
            try {
                const stored = localStorage.getItem('student-asystent:settings');
                return stored ? JSON.parse(stored) : {
                    whisperModel: 'tiny',
                    whisperLanguage: 'pl',
                    modelSource: 'remote',
                    transcriptionMode: 'auto',
                    backendUrl: 'http://localhost:3001',
                    aiMode: 'local',
                    githubRepo: '',
                    githubToken: '',
                    githubBranch: 'main'
                };
            } catch {
                return {};
            }
        }
        
        function setSettings(newSettings) {
            const current = getSettings();
            const merged = { ...current, ...newSettings };
            localStorage.setItem('student-asystent:settings', JSON.stringify(merged));
        }
        
        // ============================================
        // SUBJECT MANAGEMENT
        // ============================================
        
        async function createSubject(name, color) {
            const db = await openDatabase();
            const subject = {
                id: uid('sub_'),
                name,
                color: color || '#6366f1',
                createdAt: new Date().toISOString()
            };
            await db.put('subjects', subject, subject.id);
            return subject;
        }
        
        async function listSubjects() {
            const db = await openDatabase();
            const tx = db.transaction('subjects');
            const store = tx.objectStore('subjects');
            const subjects = [];
            let cursor = await store.openCursor();
            while (cursor) {
                subjects.push(cursor.value);
                cursor = await cursor.continue();
            }
            return subjects.sort((a, b) => a.name.localeCompare(b.name));
        }
        
        async function getSubject(id) {
            const db = await openDatabase();
            return await db.get('subjects', id);
        }
        
        async function deleteSubject(id) {
            const db = await openDatabase();
            await db.delete('subjects', id);
        }
        
        // ============================================
        // LECTURE MANAGEMENT
        // ============================================
        
        async function createLecture(subjectId, title) {
            const db = await openDatabase();
            const lecture = {
                id: uid('lec_'),
                subjectId,
                title,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            await db.put('lectures', lecture, lecture.id);
            return lecture;
        }
        
        async function listLectures() {
            const db = await openDatabase();
            const tx = db.transaction('lectures');
            const store = tx.objectStore('lectures');
            const lectures = [];
            let cursor = await store.openCursor();
            while (cursor) {
                lectures.push(cursor.value);
                cursor = await cursor.continue();
            }
            return lectures.sort((a, b) => b.createdAt.localeCompare(a.createdAt));
        }
        
        async function listLecturesBySubject(subjectId) {
            const db = await openDatabase();
            const idx = db.transaction('lectures').store.index('bySubject');
            const lectures = [];
            let cursor = await idx.openCursor(subjectId);
            while (cursor) {
                lectures.push(cursor.value);
                cursor = await cursor.continue();
            }
            return lectures.sort((a, b) => b.createdAt.localeCompare(a.createdAt));
        }
        
        async function getLecture(id) {
            const db = await openDatabase();
            return await db.get('lectures', id);
        }
        
        async function saveLectureTab(lectureId, kind, content) {
            const db = await openDatabase();
            const tab = {
                id: uid('tab_'),
                lectureId,
                kind,
                content,
                generatedAt: new Date().toISOString()
            };
            await db.put('lectureTabs', tab, tab.id);
            return tab;
        }
        
        async function getLectureTabs(lectureId) {
            const db = await openDatabase();
            const idx = db.transaction('lectureTabs').store.index('byLecture');
            const tabs = [];
            let cursor = await idx.openCursor(lectureId);
            while (cursor) {
                tabs.push(cursor.value);
                cursor = await cursor.continue();
            }
            return tabs;
        }
        
        // ============================================
        // FLASHCARD MANAGEMENT (SRS - SM-2 Algorithm)
        // ============================================
        
        function newFlashcard(subjectId, lectureId, question, answer, tags = []) {
            return {
                id: uid('fc_'),
                subjectId,
                lectureId,
                question,
                answer,
                tags,
                easiness: 2.5,
                interval: 0,
                repetition: 0,
                dueDate: new Date().toISOString(),
                history: []
            };
        }
        
        function reviewFlashcard(card, grade, now = new Date()) {
            // SM-2 algorithm
            let { easiness, interval, repetition } = card;
            
            // Update easiness
            easiness = Math.max(1.3, easiness + (0.1 - (5 - grade) * (0.08 + (5 - grade) * 0.02)));
            
            if (grade < 3) {
                repetition = 0;
                interval = 1;
            } else {
                repetition += 1;
                if (repetition === 1) interval = 1;
                else if (repetition === 2) interval = 6;
                else interval = Math.round(interval * easiness);
            }
            
            const dueDate = new Date(now);
            dueDate.setDate(dueDate.getDate() + interval);
            
            const history = [...(card.history || []), {
                date: now.toISOString(),
                quality: grade
            }];
            
            return {
                ...card,
                easiness,
                interval,
                repetition,
                dueDate: dueDate.toISOString(),
                history
            };
        }
        
        async function addFlashcards(cards) {
            const db = await openDatabase();
            const tx = db.transaction('flashcards', 'readwrite');
            
            for (const c of cards) {
                const flashcard = newFlashcard(
                    c.subjectId,
                    c.lectureId,
                    c.question,
                    c.answer,
                    c.tags
                );
                await tx.store.put(flashcard, flashcard.id);
            }
            
            await tx.done;
            log(`Dodano ${cards.length} fiszek`);
        }
        
        async function listAllFlashcards() {
            const db = await openDatabase();
            const tx = db.transaction('flashcards');
            const store = tx.objectStore('flashcards');
            const flashcards = [];
            let cursor = await store.openCursor();
            while (cursor) {
                flashcards.push(cursor.value);
                cursor = await cursor.continue();
            }
            return flashcards;
        }
        
        async function getFlashcard(id) {
            const db = await openDatabase();
            return await db.get('flashcards', id);
        }
        
        async function saveFlashcard(card) {
            const db = await openDatabase();
            await db.put('flashcards', card, card.id);
        }
        
        async function listDueFlashcards(subjectId = null) {
            const all = await listAllFlashcards();
            const now = new Date();
            return all.filter(c => {
                const isDue = new Date(c.dueDate) <= now;
                const matchesSubject = !subjectId || c.subjectId === subjectId;
                return isDue && matchesSubject;
            });
        }
        
        // ============================================
        // AI CONFIGURATION
        // ============================================
        
        env.allowRemoteModels = true;
        env.allowLocalModels = true;
        env.localModelPath = '/models';
        env.useBrowserCache = false;
        
        const isIsolated = window.crossOriginIsolated === true;
        const cores = navigator.hardwareConcurrency || 4;
        env.backends = env.backends || {};
        env.backends.onnx = env.backends.onnx || {};
        env.backends.onnx.wasm = env.backends.onnx.wasm || {};
        
        if (isIsolated) {
            env.backends.onnx.wasm.numThreads = Math.max(2, Math.min(8, cores));
            env.backends.onnx.wasm.proxy = true;
        } else {
            env.backends.onnx.wasm.numThreads = 1;
            env.backends.onnx.wasm.proxy = false;
        }
        
        log(`AI Environment: threads=${env.backends.onnx.wasm.numThreads}, isolated=${isIsolated}`);
        
        // ============================================
        // TRANSCRIPTION (with backend support)
        // ============================================
        
        let transcriberCache = {};
        
        async function checkBackend(url) {
            try {
                const response = await fetch(`${url}/health`, { method: 'GET' });
                if (response.ok) {
                    log('Backend online: ' + url);
                    return true;
                }
            } catch (e) {
                log('Backend offline: ' + url);
            }
            return false;
        }
        
        async function transcribeAudio(audioBlob, language = 'auto', onProgress = null) {
            const settings = getSettings();
            const mode = settings.transcriptionMode || 'auto';
            const backendUrl = settings.backendUrl || 'http://localhost:3001';
            
            // Try backend first if available
            if (mode === 'auto' || mode === 'backend') {
                const backendAvailable = await checkBackend(backendUrl);
                if (backendAvailable) {
                    return await transcribeWithBackend(audioBlob, language, backendUrl, onProgress);
                }
                if (mode === 'backend') {
                    throw new Error('Backend nie jest dostƒôpny. Sprawd≈∫ ustawienia.');
                }
            }
            
            // Fallback to browser
            return await transcribeInBrowser(audioBlob, language, onProgress);
        }
        
        async function transcribeWithBackend(audioBlob, language, backendUrl, onProgress) {
            log('Transkrypcja przez backend...');
            onProgress?.(10, 'wysy≈Çanie do backendu');
            
            const formData = new FormData();
            formData.append('audio', audioBlob, 'audio.wav');
            formData.append('language', language);
            formData.append('model', getSettings().whisperModel || 'tiny');
            
            const response = await fetch(`${backendUrl}/transcribe`, {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`Backend error: ${response.statusText}`);
            }
            
            const result = await response.json();
            onProgress?.(100, 'gotowe');
            
            return { text: result.text || '', language: language };
        }
        
        async function transcribeInBrowser(audioBlob, language, onProgress) {
            log('Transkrypcja w przeglƒÖdarce...');
            onProgress?.(10, '≈Çadowanie modelu');
            
            const settings = getSettings();
            const modelSize = settings.whisperModel || 'tiny';
            const modelId = `Xenova/whisper-${modelSize}`;
            
            if (!transcriberCache[modelId]) {
                log(`≈Åadowanie modelu ${modelId}...`);
                transcriberCache[modelId] = pipeline('automatic-speech-recognition', modelId, {
                    progress_callback: (ev) => {
                        const pct = ev.total ? Math.min(95, Math.round((ev.loaded / ev.total) * 85) + 10) : 15;
                        onProgress?.(pct, '≈Çadowanie modelu');
                    }
                });
            }
            
            const transcriber = await transcriberCache[modelId];
            onProgress?.(95, 'transkrypcja');
            
            // Convert blob to audio data
            const arrayBuffer = await audioBlob.arrayBuffer();
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
            
            // Get PCM data
            const pcm = audioBuffer.getChannelData(0);
            
            const result = await transcriber(pcm, {
                chunk_length_s: 30,
                stride_length_s: 5,
                return_timestamps: false,
                language: language === 'auto' ? undefined : language
            });
            
            onProgress?.(100, 'gotowe');
            
            return { text: result.text || '', language: language };
        }
        
        // ============================================
        // AI TEXT GENERATION (stub - would use real API)
        // ============================================
        
        async function generateWithAI(prompt, context = 'notes') {
            log('Generowanie przez AI: ' + context);
            // This would call a real AI API (OpenAI, Claude, etc.)
            // For now, return a stub
            await new Promise(r => setTimeout(r, 1000));
            return "Wygenerowana tre≈õƒá przez AI (demo)";
        }
        
        async function cleanTextWithAI(text) {
            log('Czyszczenie tekstu przez AI...');
            await new Promise(r => setTimeout(r, 500));
            return {
                cleanedText: text.replace(/um+|eh+|aa+h/gi, '').trim(),
                removedWords: ['um', 'eh', 'aah']
            };
        }
        
        async function generateFlashcardsFromText(text, count = 10) {
            log(`Generowanie ${count} fiszek z tekstu...`);
            // This would use real AI
            await new Promise(r => setTimeout(r, 1000));
            
            const flashcards = [];
            for (let i = 0; i < Math.min(count, 5); i++) {
                flashcards.push({
                    question: `Pytanie testowe ${i + 1}?`,
                    answer: `Odpowied≈∫ testowa ${i + 1}`,
                    tags: ['auto-generated']
                });
            }
            return flashcards;
        }
        
        // ============================================
        // UI STATE MANAGEMENT
        // ============================================
        
        let currentState = {
            activeTab: 'dashboard',
            subjects: [],
            lectures: [],
            flashcards: [],
            stats: { new: 0, overdue: 0, done: 0 }
        };
        
        async function loadData() {
            currentState.subjects = await listSubjects();
            currentState.lectures = await listLectures();
            currentState.flashcards = await listAllFlashcards();
            
            const now = new Date();
            const overdue = currentState.flashcards.filter(c => new Date(c.dueDate) <= now);
            const newCards = currentState.flashcards.filter(c => c.repetition === 0);
            const done = currentState.flashcards.filter(c => c.repetition > 0 && new Date(c.dueDate) > now);
            
            currentState.stats = {
                new: newCards.length,
                overdue: overdue.length,
                done: done.length
            };
        }
        
        function renderDashboard() {
            // Update stats
            const statCards = document.querySelectorAll('.stat-value');
            if (statCards.length >= 4) {
                statCards[0].textContent = currentState.flashcards.length;
                statCards[1].textContent = currentState.subjects.length;
                statCards[2].textContent = currentState.lectures.length;
                statCards[3].textContent = Math.round(Math.random() * 15 + 5); // streak (demo)
            }
        }
        
        function renderFlashcards() {
            // This would render real flashcards from DB
            log('Rendering flashcards...');
        }
        
        function renderLectures() {
            // This would render real lectures from DB
            log('Rendering lectures...');
        }
        
        function renderSubjects() {
            // This would render real subjects from DB
            log('Rendering subjects...');
        }
        
        // ============================================
        // NEW LECTURE FORM HANDLING
        // ============================================
        
        let currentAudioFile = null;
        
        function setupNewLectureForm() {
            const form = document.getElementById('new-lecture-form');
            const subjectSelect = document.getElementById('lecture-subject');
            const dropzone = document.getElementById('audio-dropzone');
            const fileInput = document.getElementById('audio-file');
            const audioInfo = document.getElementById('audio-info');
            const audioRemove = document.getElementById('audio-remove');
            const submitBtn = document.getElementById('lecture-submit');
            
            // Populate subjects
            currentState.subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = subject.name;
                subjectSelect.appendChild(option);
            });
            
            // Dropzone handlers
            dropzone.addEventListener('click', () => fileInput.click());
            
            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.style.borderColor = 'var(--primary)';
                dropzone.style.background = 'var(--bg-card)';
            });
            
            dropzone.addEventListener('dragleave', () => {
                dropzone.style.borderColor = 'var(--border)';
                dropzone.style.background = 'var(--bg-hover)';
            });
            
            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.style.borderColor = 'var(--border)';
                dropzone.style.background = 'var(--bg-hover)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleAudioFile(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleAudioFile(e.target.files[0]);
                }
            });
            
            audioRemove.addEventListener('click', () => {
                currentAudioFile = null;
                fileInput.value = '';
                audioInfo.style.display = 'none';
                dropzone.style.display = 'block';
            });
            
            form.addEventListener('submit', handleNewLectureSubmit);
        }
        
        function handleAudioFile(file) {
            if (!file.type.startsWith('audio/')) {
                alert('Proszƒô wybraƒá plik audio');
                return;
            }
            
            if (file.size > 500 * 1024 * 1024) {
                alert('Plik jest za du≈ºy (maksymalnie 500MB)');
                return;
            }
            
            currentAudioFile = file;
            
            // Update UI
            document.getElementById('audio-dropzone').style.display = 'none';
            document.getElementById('audio-info').style.display = 'block';
            document.getElementById('audio-filename').textContent = file.name;
            
            const sizeMB = (file.size / 1024 / 1024).toFixed(2);
            document.getElementById('audio-size').textContent = `${sizeMB} MB`;
            
            // Show warning for large files
            const warningDiv = document.getElementById('audio-warning');
            if (file.size > 100 * 1024 * 1024) {
                const estimatedMin = (file.size / 1024 / 1024 / 0.7).toFixed(0);
                warningDiv.innerHTML = `
                    <div style="display: flex; gap: 12px; align-items: start;">
                        <span style="font-size: 20px;">‚ö†Ô∏è</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">
                                Du≈ºy plik (${sizeMB}MB)
                            </div>
                            <div style="font-size: 13px; color: var(--text-secondary);">
                                Transkrypcja mo≈ºe zajƒÖƒá ${(estimatedMin * 0.7).toFixed(0)}-${(estimatedMin * 1.2).toFixed(0)} minut.
                                Zalecane jest u≈ºycie lokalnego backendu dla szybszego przetwarzania.
                            </div>
                        </div>
                    </div>
                `;
                warningDiv.style.display = 'block';
                warningDiv.style.background = 'rgba(236, 72, 153, 0.1)';
                warningDiv.style.border = '1px solid rgba(236, 72, 153, 0.3)';
            } else if (file.size > 20 * 1024 * 1024) {
                warningDiv.innerHTML = `
                    <div style="display: flex; gap: 12px; align-items: start;">
                        <span style="font-size: 20px;">‚ÑπÔ∏è</span>
                        <div style="flex: 1; font-size: 13px; color: var(--text-secondary);">
                            Szacowany czas transkrypcji: ~${(file.size / 1024 / 1024 / 0.7 * 0.7).toFixed(0)} minut
                        </div>
                    </div>
                `;
                warningDiv.style.display = 'block';
                warningDiv.style.background = 'rgba(99, 102, 241, 0.1)';
                warningDiv.style.border = '1px solid rgba(99, 102, 241, 0.3)';
            } else {
                warningDiv.style.display = 'none';
            }
        }
        
        async function handleNewLectureSubmit(e) {
            e.preventDefault();
            
            const subjectId = document.getElementById('lecture-subject').value;
            if (!subjectId) {
                alert('Proszƒô wybraƒá przedmiot');
                return;
            }
            
            if (!currentAudioFile) {
                alert('Proszƒô wybraƒá plik audio');
                return;
            }
            
            const submitBtn = document.getElementById('lecture-submit');
            const progressDiv = document.getElementById('transcription-progress');
            const progressFill = document.getElementById('progress-fill');
            const progressPercent = document.getElementById('progress-percent');
            const progressLabel = document.getElementById('progress-label');
            const progressPhase = document.getElementById('progress-phase');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ Przetwarzanie...';
                progressDiv.style.display = 'block';
                
                // 1. Transkrypcja
                updateProgress(10, 'Przygotowanie audio...', '');
                
                const transcriptionResult = await transcribeAudio(
                    currentAudioFile,
                    getSettings().whisperLanguage || 'pl',
                    (percent, phase) => {
                        updateProgress(percent, 'Transkrypcja audio', phase);
                    }
                );
                
                updateProgress(95, 'Tworzenie wyk≈Çadu...', 'zapisywanie');
                
                // 2. Generate title from transcript
                const titleWords = transcriptionResult.text.trim().split(/\s+/).slice(0, 6).join(' ');
                const title = titleWords || `Wyk≈Çad ${new Date().toLocaleDateString('pl-PL')}`;
                
                // 3. Create lecture
                const lecture = await createLecture(subjectId, title);
                
                // 4. Save transcript
                await saveLectureTab(lecture.id, 'transcript', transcriptionResult.text);
                
                updateProgress(100, 'Gotowe!', 'wyk≈Çad utworzony');
                
                // Show success
                setTimeout(() => {
                    document.getElementById('new-lecture-form').style.display = 'none';
                    const resultDiv = document.getElementById('lecture-result');
                    const resultInfo = document.getElementById('lecture-result-info');
                    
                    const subject = currentState.subjects.find(s => s.id === subjectId);
                    const wordCount = transcriptionResult.text.split(/\s+/).length;
                    
                    resultInfo.innerHTML = `
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary);">Tytu≈Ç:</span>
                                <span style="font-weight: 600; color: var(--text);">${title}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary);">Przedmiot:</span>
                                <span style="font-weight: 600; color: var(--text);">${subject?.name || 'Nieznany'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-secondary);">Transkrypcja:</span>
                                <span style="font-weight: 600; color: var(--text);">${wordCount} s≈Ç√≥w</span>
                            </div>
                        </div>
                    `;
                    
                    resultDiv.style.display = 'block';
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 500);
                
            } catch (error) {
                console.error('B≈ÇƒÖd podczas tworzenia wyk≈Çadu:', error);
                alert('WystƒÖpi≈Ç b≈ÇƒÖd: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ Transkrybuj i utw√≥rz wyk≈Çad';
                progressDiv.style.display = 'none';
            }
            
            function updateProgress(percent, label, phase) {
                progressFill.style.width = percent + '%';
                progressPercent.textContent = Math.round(percent) + '%';
                progressLabel.textContent = label;
                progressPhase.textContent = phase;
            }
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        const navBtns = document.querySelectorAll('.nav-btn');
        const contents = document.querySelectorAll('.content');

        navBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                const tab = btn.dataset.tab;
                
                navBtns.forEach(b => b.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(tab).classList.add('active');
                
                currentState.activeTab = tab;
                
                // Load data for tab
                switch(tab) {
                    case 'dashboard':
                        renderDashboard();
                        break;
                    case 'flashcards':
                        renderFlashcards();
                        break;
                    case 'lectures':
                        renderLectures();
                        break;
                    case 'new-lecture':
                        setupNewLectureForm();
                        break;
                    case 'subjects':
                        renderSubjects();
                        break;
                    case 'settings':
                        loadSettingsUI();
                        break;
                }
            });
        });

        // Flashcards flip animation
        document.querySelectorAll('.flashcard').forEach(card => {
            card.addEventListener('click', function() {
                this.classList.toggle('flipped');
            });
        });

        // Search functionality
        document.querySelectorAll('.search-box').forEach(searchBox => {
            searchBox.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                log('Searching for: ' + searchTerm);
            });
        });

        // Add subtle parallax effect
        document.addEventListener('mousemove', (e) => {
            const gradient = document.querySelector('.background-gradient');
            const x = e.clientX / window.innerWidth;
            const y = e.clientY / window.innerHeight;
            
            gradient.style.transform = `translate(${x * 20}px, ${y * 20}px)`;
        });
        
        // ============================================
        // SETTINGS MANAGEMENT UI
        // ============================================
        
        async function loadSettingsUI() {
            const settings = getSettings();
            
            // Load values into form
            document.getElementById('setting-transcription-mode').value = settings.transcriptionMode || 'auto';
            document.getElementById('setting-backend-url').value = settings.backendUrl || 'http://localhost:3001';
            document.getElementById('setting-whisper-model').value = settings.whisperModel || 'tiny';
            document.getElementById('setting-whisper-language').value = settings.whisperLanguage || 'pl';
            document.getElementById('setting-model-source').value = settings.modelSource || 'remote';
            document.getElementById('setting-github-repo').value = settings.githubRepo || '';
            document.getElementById('setting-github-token').value = settings.githubToken || '';
            document.getElementById('setting-github-branch').value = settings.githubBranch || 'main';
            document.getElementById('setting-auto-sync').checked = settings.autoSync || false;
            document.getElementById('setting-daily-limit').value = settings.dailyLimit || 30;
            document.getElementById('setting-auto-flashcards').checked = settings.autoFlashcards !== false;
            document.getElementById('setting-flashcard-reminders').checked = settings.flashcardReminders !== false;
            document.getElementById('setting-auto-delete-audio').checked = settings.autoDeleteAudio !== false;
            
            // Check backend status
            const backendUrl = settings.backendUrl || 'http://localhost:3001';
            const statusIndicator = document.getElementById('backend-status-indicator');
            statusIndicator.textContent = 'Sprawdzanie...';
            statusIndicator.style.background = 'rgba(99, 102, 241, 0.2)';
            statusIndicator.style.color = 'var(--primary)';
            
            const isOnline = await checkBackend(backendUrl);
            if (isOnline) {
                statusIndicator.textContent = '‚úÖ Backend online';
                statusIndicator.style.background = 'rgba(16, 185, 129, 0.2)';
                statusIndicator.style.color = 'var(--success)';
            } else {
                statusIndicator.textContent = '‚ùå Backend offline';
                statusIndicator.style.background = 'rgba(239, 68, 68, 0.2)';
                statusIndicator.style.color = '#ef4444';
            }
        }
        
        function saveSettings() {
            const newSettings = {
                transcriptionMode: document.getElementById('setting-transcription-mode').value,
                backendUrl: document.getElementById('setting-backend-url').value,
                whisperModel: document.getElementById('setting-whisper-model').value,
                whisperLanguage: document.getElementById('setting-whisper-language').value,
                modelSource: document.getElementById('setting-model-source').value,
                githubRepo: document.getElementById('setting-github-repo').value,
                githubToken: document.getElementById('setting-github-token').value,
                githubBranch: document.getElementById('setting-github-branch').value,
                autoSync: document.getElementById('setting-auto-sync').checked,
                dailyLimit: parseInt(document.getElementById('setting-daily-limit').value),
                autoFlashcards: document.getElementById('setting-auto-flashcards').checked,
                flashcardReminders: document.getElementById('setting-flashcard-reminders').checked,
                autoDeleteAudio: document.getElementById('setting-auto-delete-audio').checked
            };
            
            setSettings(newSettings);
            alert('‚úÖ Ustawienia zapisane!');
            log('Ustawienia zaktualizowane');
        }
        
        async function clearAllData() {
            try {
                const db = await openDatabase();
                const stores = ['subjects', 'lectures', 'lectureTabs', 'flashcards', 'quizQuestions', 'chatMessages', 'sessions', 'notes', 'tempFiles'];
                
                for (const storeName of stores) {
                    const tx = db.transaction(storeName, 'readwrite');
                    await tx.store.clear();
                    await tx.done;
                }
                
                alert('‚úÖ Wszystkie dane zosta≈Çy usuniƒôte');
                location.reload();
            } catch (error) {
                alert('‚ùå B≈ÇƒÖd podczas czyszczenia danych: ' + error.message);
            }
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        async function initialize() {
            log('Inicjalizacja Student Assistant...');
            
            try {
                await openDatabase();
                await loadData();
                renderDashboard();
                
                log('Student Assistant gotowy do u≈ºycia!');
                log(`Przedmioty: ${currentState.subjects.length}, Wyk≈Çady: ${currentState.lectures.length}, Fiszki: ${currentState.flashcards.length}`);
            } catch (error) {
                console.error('B≈ÇƒÖd inicjalizacji:', error);
            }
        }
        
        // Start app
        initialize();
        
        // ============================================
        // DATABASE MANAGEMENT FUNCTIONS
        // ============================================
        
        async function cleanupOrphanedFlashcards() {
            try {
                // Import the database module
                const dbModule = await import('./frontend/js/modules/database.js');
                
                // Check for orphaned flashcards first
                const orphaned = await dbModule.findOrphanedFlashcards();
                
                if (orphaned.length === 0) {
                    showDatabaseStatus('‚úÖ Brak osieroconych fiszek do usuniƒôcia!', 'success');
                    return;
                }
                
                // Ask for confirmation
                const confirmed = confirm(`Znaleziono ${orphaned.length} osieroconych fiszek. Czy chcesz je usunƒÖƒá?\\n\\nFiszki do usuniƒôcia:\\n${orphaned.slice(0, 5).map(f => '‚Ä¢ ' + f.front).join('\\n')}${orphaned.length > 5 ? '\\n...i wiƒôcej' : ''}`);
                
                if (!confirmed) return;
                
                // Clean up
                const removedCount = await dbModule.cleanupOrphanedFlashcards();
                showDatabaseStatus(`‚úÖ Usuniƒôto ${removedCount} osieroconych fiszek!`, 'success');
                
                // Refresh flashcard view if it's currently open
                if (currentState.activeTab === 'flashcards') {
                    listAllFlashcards();
                }
                
            } catch (error) {
                console.error('B≈ÇƒÖd podczas czyszczenia fiszek:', error);
                showDatabaseStatus('‚ùå B≈ÇƒÖd podczas czyszczenia: ' + error.message, 'error');
            }
        }
        
        async function checkDatabaseHealth() {
            try {
                const dbModule = await import('./frontend/js/modules/database.js');
                
                // Get statistics
                const subjects = await dbModule.listSubjects();
                const lectures = await dbModule.listLectures();
                const flashcards = await dbModule.listFlashcards();
                const orphaned = await dbModule.findOrphanedFlashcards();
                
                // Calculate stats
                const totalFlashcards = flashcards.length;
                const orphanedCount = orphaned.length;
                const validFlashcards = totalFlashcards - orphanedCount;
                
                const stats = `
                üìö Przedmioty: ${subjects.length}
                üéì Wyk≈Çady: ${lectures.length} 
                üÉè Fiszki: ${validFlashcards} (poprawne) + ${orphanedCount} (osierocone)
                ${orphanedCount > 0 ? '‚ö†Ô∏è Zalecane: uruchom czyszczenie osieroconych fiszek' : '‚úÖ Baza danych w dobrym stanie'}
                `;
                
                showDatabaseStatus(stats, orphanedCount > 0 ? 'warning' : 'success');
                
            } catch (error) {
                console.error('B≈ÇƒÖd podczas sprawdzania bazy:', error);
                showDatabaseStatus('‚ùå B≈ÇƒÖd podczas sprawdzania: ' + error.message, 'error');
            }
        }
        
        function showDatabaseStatus(message, type = 'info') {
            const statusDiv = document.getElementById('database-status');
            const detailsDiv = document.getElementById('database-details');
            
            if (statusDiv && detailsDiv) {
                statusDiv.style.display = 'block';
                detailsDiv.innerHTML = message.replace(/\\n/g, '<br>');
                
                // Update border color based on type
                switch(type) {
                    case 'success':
                        statusDiv.style.borderLeftColor = 'var(--success)';
                        break;
                    case 'warning':
                        statusDiv.style.borderLeftColor = '#f59e0b';
                        break;
                    case 'error':
                        statusDiv.style.borderLeftColor = '#ef4444';
                        break;
                    default:
                        statusDiv.style.borderLeftColor = 'var(--primary)';
                }
            }
        }
        
        // Export functions to global scope
        window.cleanupOrphanedFlashcards = cleanupOrphanedFlashcards;
        window.checkDatabaseHealth = checkDatabaseHealth;
        
        // Expose API for debugging
        window.StudentAssistant = {
            createSubject,
            listSubjects,
            createLecture,
            listLectures,
            addFlashcards,
            listAllFlashcards,
            transcribeAudio,
            getSettings,
            setSettings,
            currentState
        };
        
    </script>
</body>
</html>